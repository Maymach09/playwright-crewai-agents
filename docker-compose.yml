version: '3.8'

services:
  playwright-agents:
    build: .
    container_name: playwright-crewai-agents
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - HEADLESS=true
      - LOG_LEVEL=INFO
    volumes:
      - ./logs:/app/logs
      - ./test_plan:/app/test_plan
      - ./tests:/app/tests
      - ./auth_state.json:/app/auth_state.json:ro
    ports:
      - "8501:8501"  # Streamlit port
    restart: unless-stopped
    command: python src/test_ai_assistant/main.py

  # Optional: Streamlit UI service
  streamlit-ui:
    build: .
    container_name: playwright-agents-ui
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    volumes:
      - ./logs:/app/logs
      - ./test_plan:/app/test_plan
      - ./tests:/app/tests
    ports:
      - "8502:8501"
    command: streamlit run app.py
    profiles:
      - ui
